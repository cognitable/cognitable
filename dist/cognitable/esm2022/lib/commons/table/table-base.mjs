import { EventEmitter } from '@angular/core';
export class TableBase {
    // Init
    afterTableInit = new EventEmitter();
    // Header
    tableHeaders;
    // Data
    tableData;
    // Backup
    backupData; // For backup the table data, so that additional processes won't be affecting it
    // Pagination
    paginationEnabled = false;
    allowedPageSizes = [10, 25, 50, 100];
    pageSize = 10;
    totalPages = 0;
    currentPage = 1;
    paginationButtons = [];
    // Cell Events
    cellContentClicked = new EventEmitter();
    cellContentHover = new EventEmitter();
    cellValueChanged = new EventEmitter();
    // Table Size
    height = 400;
    // Overlays
    loading = false;
    noData = false;
    loadingMessage;
    noDataMessage;
    constructor() { }
    changeCellValue(header, rowData, value) {
        rowData[header.field] = value;
        this.cellValueChanged.emit({
            header: header,
            rowData: rowData,
            value: value
        });
    }
    setBackupData(data) {
        this.backupData = JSON.parse(JSON.stringify(data ?? []));
    }
    sort(field, order) {
        if (!order) {
            this.tableData = JSON.parse(JSON.stringify(this.backupData ?? []));
        }
        else {
            this.tableData = this.tableData.sort((a, b) => {
                if (a[field] < b[field]) {
                    return order === 'asc' ? -1 : 1;
                }
                if (a[field] > b[field]) {
                    return order === 'asc' ? 1 : -1;
                }
                return 0;
            });
        }
    }
    filter(filterValue, headers) {
        // this.backupData = (filterValue && !this.backupData?.length) ? this.setBackupData(this.tableData) : this.backupData; // Taking the backup of original data
        if (headers?.length) {
            this.filterBySpecifiedFields(headers, filterValue);
        }
        else {
            this.filterByAllFields(filterValue);
        }
    }
    filterByAllFields(filterValue) {
        const nonSearchableHeaders = this.tableHeaders?.filter(header => header?.search?.columnSearchIgnored); // Filtering the search not allowed column headers
        const nonSearchFields = nonSearchableHeaders?.map(header => header.field);
        let temporaryData = JSON.parse(JSON.stringify(this.backupData ?? []));
        temporaryData = temporaryData.filter((record) => {
            for (const recordField in (record ?? {})) {
                if (!nonSearchFields?.includes(recordField)) {
                    const value = record[recordField];
                    if (typeof value === 'string' && value?.length && value.toLowerCase().includes(filterValue.toLowerCase())) {
                        return true;
                    }
                }
            }
            return false;
        });
        this.tableData = temporaryData;
    }
    filterBySpecifiedFields(filterValue, headers) {
    }
    loadPagination() {
        if (this.paginationEnabled && this.backupData?.length) {
            this.totalPages = Math.ceil(this.pageSize && this.backupData.length ? this.backupData.length / this.pageSize : 0);
            this.changePagination(1);
        }
    }
    changePagination(page) {
        this.currentPage = page;
        this.tableData = this.getCurrentPageData();
    }
    getCurrentPageData() {
        if (this.currentPage && this.pageSize && this.backupData?.length) {
            const pageStartIndex = (this.currentPage * this.pageSize) - this.pageSize;
            return this.backupData.slice(pageStartIndex, pageStartIndex + this.pageSize);
        }
        return [];
    }
    setLoading(loading) {
        this.loading = loading;
    }
    setNoData(noData) {
        this.noData = noData;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUtYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29tbW9ucy90YWJsZS90YWJsZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFM0MsTUFBTSxPQUFPLFNBQVM7SUFDbEIsT0FBTztJQUNBLGNBQWMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBRTNDLFNBQVM7SUFDRixZQUFZLENBQTRCO0lBRS9DLE9BQU87SUFDQSxTQUFTLENBQU07SUFFdEIsU0FBUztJQUNGLFVBQVUsQ0FBTSxDQUFDLGdGQUFnRjtJQUV4RyxhQUFhO0lBQ2IsaUJBQWlCLEdBQVksS0FBSyxDQUFDO0lBQ25DLGdCQUFnQixHQUFhLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDL0MsUUFBUSxHQUFXLEVBQUUsQ0FBQztJQUN0QixVQUFVLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsV0FBVyxHQUFHLENBQUMsQ0FBQztJQUNoQixpQkFBaUIsR0FBVSxFQUFFLENBQUM7SUFFOUIsY0FBYztJQUNQLGtCQUFrQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFDeEMsZ0JBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUN0QyxnQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBRTdDLGFBQWE7SUFDYixNQUFNLEdBQVcsR0FBRyxDQUFDO0lBRXJCLFdBQVc7SUFDWCxPQUFPLEdBQVksS0FBSyxDQUFDO0lBQ3pCLE1BQU0sR0FBWSxLQUFLLENBQUM7SUFDeEIsY0FBYyxDQUFVO0lBQ3hCLGFBQWEsQ0FBVTtJQUV2QixnQkFBZ0IsQ0FBQztJQUVqQixlQUFlLENBQUMsTUFBbUIsRUFBRSxPQUFZLEVBQUUsS0FBVTtRQUN6RCxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUM5QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDO1lBQ3ZCLE1BQU0sRUFBRSxNQUFNO1lBQ2QsT0FBTyxFQUFFLE9BQU87WUFDaEIsS0FBSyxFQUFFLEtBQUs7U0FDZixDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsYUFBYSxDQUFDLElBQVM7UUFDbkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELElBQUksQ0FBQyxLQUFhLEVBQUUsS0FBeUI7UUFDekMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1QsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7YUFBTSxDQUFDO1lBQ0osSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsRUFBRTtnQkFDcEQsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7b0JBQ3RCLE9BQU8sS0FBSyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEMsQ0FBQztnQkFDRCxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztvQkFDdEIsT0FBTyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNwQyxDQUFDO2dCQUNELE9BQU8sQ0FBQyxDQUFDO1lBQ2IsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDO0lBQ0wsQ0FBQztJQUVELE1BQU0sQ0FBQyxXQUFnQixFQUFFLE9BQXVCO1FBQzVDLDRKQUE0SjtRQUM1SixJQUFJLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUNsQixJQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7YUFBTSxDQUFDO1lBQ0osSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLENBQUM7SUFDTCxDQUFDO0lBRUQsaUJBQWlCLENBQUMsV0FBZ0I7UUFDOUIsTUFBTSxvQkFBb0IsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLGtEQUFrRDtRQUN6SixNQUFNLGVBQWUsR0FBRyxvQkFBb0IsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUUsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RSxhQUFhLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FDaEMsQ0FBQyxNQUFXLEVBQUUsRUFBRTtZQUNaLEtBQUssTUFBTSxXQUFXLElBQUksQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQztnQkFDdkMsSUFBSSxDQUFDLGVBQWUsRUFBRSxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztvQkFDMUMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO29CQUNsQyxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxLQUFLLEVBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQzt3QkFDeEcsT0FBTyxJQUFJLENBQUM7b0JBQ2hCLENBQUM7Z0JBQ0wsQ0FBQztZQUNMLENBQUM7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDLENBQ0osQ0FBQztRQUNGLElBQUksQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDO0lBQ25DLENBQUM7SUFFRCx1QkFBdUIsQ0FBQyxXQUFnQixFQUFFLE9BQXVCO0lBRWpFLENBQUM7SUFFRCxjQUFjO1FBQ1YsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUNwRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEgsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdCLENBQUM7SUFDTCxDQUFDO0lBRUQsZ0JBQWdCLENBQUMsSUFBUztRQUN0QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQy9DLENBQUM7SUFFRCxrQkFBa0I7UUFDZCxJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxDQUFDO1lBQy9ELE1BQU0sY0FBYyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUMxRSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxjQUFjLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pGLENBQUM7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFFRCxVQUFVLENBQUMsT0FBZ0I7UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDM0IsQ0FBQztJQUVELFNBQVMsQ0FBQyxNQUFlO1FBQ3JCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3pCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VGFibGVIZWFkZXJ9IGZyb20gJy4uL21vZGVscy90YWJsZS1oZWFkZXInO1xuaW1wb3J0IHtFdmVudEVtaXR0ZXJ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5leHBvcnQgY2xhc3MgVGFibGVCYXNlIHtcbiAgICAvLyBJbml0XG4gICAgcHVibGljIGFmdGVyVGFibGVJbml0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgLy8gSGVhZGVyXG4gICAgcHVibGljIHRhYmxlSGVhZGVyczogVGFibGVIZWFkZXJbXSB8IHVuZGVmaW5lZDtcblxuICAgIC8vIERhdGFcbiAgICBwdWJsaWMgdGFibGVEYXRhOiBhbnk7XG5cbiAgICAvLyBCYWNrdXBcbiAgICBwdWJsaWMgYmFja3VwRGF0YTogYW55OyAvLyBGb3IgYmFja3VwIHRoZSB0YWJsZSBkYXRhLCBzbyB0aGF0IGFkZGl0aW9uYWwgcHJvY2Vzc2VzIHdvbid0IGJlIGFmZmVjdGluZyBpdFxuXG4gICAgLy8gUGFnaW5hdGlvblxuICAgIHBhZ2luYXRpb25FbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgYWxsb3dlZFBhZ2VTaXplczogbnVtYmVyW10gPSBbMTAsIDI1LCA1MCwgMTAwXTtcbiAgICBwYWdlU2l6ZTogbnVtYmVyID0gMTA7XG4gICAgdG90YWxQYWdlcyA9IDA7XG4gICAgY3VycmVudFBhZ2UgPSAxO1xuICAgIHBhZ2luYXRpb25CdXR0b25zOiBhbnlbXSA9IFtdO1xuXG4gICAgLy8gQ2VsbCBFdmVudHNcbiAgICBwdWJsaWMgY2VsbENvbnRlbnRDbGlja2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHB1YmxpYyBjZWxsQ29udGVudEhvdmVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHB1YmxpYyBjZWxsVmFsdWVDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgLy8gVGFibGUgU2l6ZVxuICAgIGhlaWdodDogbnVtYmVyID0gNDAwO1xuXG4gICAgLy8gT3ZlcmxheXNcbiAgICBsb2FkaW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgbm9EYXRhOiBib29sZWFuID0gZmFsc2U7XG4gICAgbG9hZGluZ01lc3NhZ2UhOiBzdHJpbmc7XG4gICAgbm9EYXRhTWVzc2FnZSE6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKCkgeyB9XG5cbiAgICBjaGFuZ2VDZWxsVmFsdWUoaGVhZGVyOiBUYWJsZUhlYWRlciwgcm93RGF0YTogYW55LCB2YWx1ZTogYW55KSB7XG4gICAgICAgIHJvd0RhdGFbaGVhZGVyLmZpZWxkXSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmNlbGxWYWx1ZUNoYW5nZWQuZW1pdCh7XG4gICAgICAgICAgICBoZWFkZXI6IGhlYWRlcixcbiAgICAgICAgICAgIHJvd0RhdGE6IHJvd0RhdGEsXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWVcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0QmFja3VwRGF0YShkYXRhOiBhbnkpIHtcbiAgICAgICAgdGhpcy5iYWNrdXBEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhID8/IFtdKSlcbiAgICB9XG5cbiAgICBzb3J0KGZpZWxkOiBzdHJpbmcsIG9yZGVyOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKCFvcmRlcikge1xuICAgICAgICAgICAgdGhpcy50YWJsZURhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuYmFja3VwRGF0YSA/PyBbXSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50YWJsZURhdGEgPSB0aGlzLnRhYmxlRGF0YS5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChhW2ZpZWxkXSA8IGJbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmRlciA9PT0gJ2FzYycgPyAtMSA6IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhW2ZpZWxkXSA+IGJbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmRlciA9PT0gJ2FzYycgPyAxIDogLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmaWx0ZXIoZmlsdGVyVmFsdWU6IGFueSwgaGVhZGVycz86IFRhYmxlSGVhZGVyW10pIHtcbiAgICAgICAgLy8gdGhpcy5iYWNrdXBEYXRhID0gKGZpbHRlclZhbHVlICYmICF0aGlzLmJhY2t1cERhdGE/Lmxlbmd0aCkgPyB0aGlzLnNldEJhY2t1cERhdGEodGhpcy50YWJsZURhdGEpIDogdGhpcy5iYWNrdXBEYXRhOyAvLyBUYWtpbmcgdGhlIGJhY2t1cCBvZiBvcmlnaW5hbCBkYXRhXG4gICAgICAgIGlmIChoZWFkZXJzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyQnlTcGVjaWZpZWRGaWVsZHMoaGVhZGVycywgZmlsdGVyVmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJCeUFsbEZpZWxkcyhmaWx0ZXJWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmaWx0ZXJCeUFsbEZpZWxkcyhmaWx0ZXJWYWx1ZTogYW55KSB7XG4gICAgICAgIGNvbnN0IG5vblNlYXJjaGFibGVIZWFkZXJzID0gdGhpcy50YWJsZUhlYWRlcnM/LmZpbHRlcihoZWFkZXIgPT4gaGVhZGVyPy5zZWFyY2g/LmNvbHVtblNlYXJjaElnbm9yZWQpOyAvLyBGaWx0ZXJpbmcgdGhlIHNlYXJjaCBub3QgYWxsb3dlZCBjb2x1bW4gaGVhZGVyc1xuICAgICAgICBjb25zdCBub25TZWFyY2hGaWVsZHMgPSBub25TZWFyY2hhYmxlSGVhZGVycz8ubWFwKGhlYWRlciA9PiBoZWFkZXIuZmllbGQpO1xuICAgICAgICBsZXQgdGVtcG9yYXJ5RGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5iYWNrdXBEYXRhID8/IFtdKSk7XG4gICAgICAgIHRlbXBvcmFyeURhdGEgPSB0ZW1wb3JhcnlEYXRhLmZpbHRlcihcbiAgICAgICAgICAgIChyZWNvcmQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVjb3JkRmllbGQgaW4gKHJlY29yZCA/PyB7fSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFub25TZWFyY2hGaWVsZHM/LmluY2x1ZGVzKHJlY29yZEZpZWxkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSByZWNvcmRbcmVjb3JkRmllbGRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWU/Lmxlbmd0aCAmJiB2YWx1ZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlclZhbHVlLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IHRlbXBvcmFyeURhdGE7XG4gICAgfVxuXG4gICAgZmlsdGVyQnlTcGVjaWZpZWRGaWVsZHMoZmlsdGVyVmFsdWU6IGFueSwgaGVhZGVycz86IFRhYmxlSGVhZGVyW10pIHtcblxuICAgIH1cblxuICAgIGxvYWRQYWdpbmF0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5wYWdpbmF0aW9uRW5hYmxlZCAmJiB0aGlzLmJhY2t1cERhdGE/Lmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy50b3RhbFBhZ2VzID0gTWF0aC5jZWlsKHRoaXMucGFnZVNpemUgJiYgdGhpcy5iYWNrdXBEYXRhLmxlbmd0aCA/IHRoaXMuYmFja3VwRGF0YS5sZW5ndGggLyB0aGlzLnBhZ2VTaXplIDogMCk7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZVBhZ2luYXRpb24oMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjaGFuZ2VQYWdpbmF0aW9uKHBhZ2U6IGFueSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gcGFnZTtcbiAgICAgICAgdGhpcy50YWJsZURhdGEgPSB0aGlzLmdldEN1cnJlbnRQYWdlRGF0YSgpO1xuICAgIH1cblxuICAgIGdldEN1cnJlbnRQYWdlRGF0YSgpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFBhZ2UgJiYgdGhpcy5wYWdlU2l6ZSAmJiB0aGlzLmJhY2t1cERhdGE/Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgcGFnZVN0YXJ0SW5kZXggPSAodGhpcy5jdXJyZW50UGFnZSAqIHRoaXMucGFnZVNpemUpIC0gdGhpcy5wYWdlU2l6ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmJhY2t1cERhdGEuc2xpY2UocGFnZVN0YXJ0SW5kZXgsIHBhZ2VTdGFydEluZGV4ICsgdGhpcy5wYWdlU2l6ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHNldExvYWRpbmcobG9hZGluZzogYm9vbGVhbikge1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBsb2FkaW5nO1xuICAgIH1cblxuICAgIHNldE5vRGF0YShub0RhdGE6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5ub0RhdGEgPSBub0RhdGE7XG4gICAgfVxufVxuIl19